{"filter":false,"title":"BookController.php","tooltip":"/cms/app/Http/Controllers/BookController.php","ace":{"folds":[],"scrolltop":733,"scrollleft":0,"selection":{"start":{"row":77,"column":25},"end":{"row":77,"column":25},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"beeec17deeb5f079e4724fb9d50a784ffa32805e","undoManager":{"mark":47,"position":47,"stack":[[{"start":{"row":5,"column":28},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":55}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":14},"action":"insert","lines":["use Validator;"],"id":56}],[{"start":{"row":38,"column":7},"end":{"row":38,"column":10},"action":"remove","lines":[" //"],"id":57},{"start":{"row":38,"column":7},"end":{"row":60,"column":23},"action":"insert","lines":["$validator = Validator::make($request->all(), [","         'item_name' => 'required|min:3|max:255',","         'item_number' => 'required | min:1 | max:3',","         'item_amount' => 'required | max:6',","         'published'   => 'required',","    ]);","","    //バリデーション:エラー ","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","    //以下に登録処理を記述（Eloquentモデル）","","  // Eloquentモデル","  $books = new Book;","  $books->item_name   = $request->item_name;","  $books->item_number = $request->item_number;","  $books->item_amount = $request->item_amount;","  $books->published   = $request->published;","  $books->save(); ","  return redirect('/');"]}],[{"start":{"row":38,"column":0},"end":{"row":38,"column":4},"action":"insert","lines":["    "],"id":58},{"start":{"row":39,"column":0},"end":{"row":39,"column":4},"action":"insert","lines":["    "]},{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"insert","lines":["    "]},{"start":{"row":41,"column":0},"end":{"row":41,"column":4},"action":"insert","lines":["    "]},{"start":{"row":42,"column":0},"end":{"row":42,"column":4},"action":"insert","lines":["    "]},{"start":{"row":43,"column":0},"end":{"row":43,"column":4},"action":"insert","lines":["    "]},{"start":{"row":44,"column":0},"end":{"row":44,"column":4},"action":"insert","lines":["    "]},{"start":{"row":45,"column":0},"end":{"row":45,"column":4},"action":"insert","lines":["    "]},{"start":{"row":46,"column":0},"end":{"row":46,"column":4},"action":"insert","lines":["    "]},{"start":{"row":47,"column":0},"end":{"row":47,"column":4},"action":"insert","lines":["    "]},{"start":{"row":48,"column":0},"end":{"row":48,"column":4},"action":"insert","lines":["    "]},{"start":{"row":49,"column":0},"end":{"row":49,"column":4},"action":"insert","lines":["    "]},{"start":{"row":50,"column":0},"end":{"row":50,"column":4},"action":"insert","lines":["    "]},{"start":{"row":51,"column":0},"end":{"row":51,"column":4},"action":"insert","lines":["    "]},{"start":{"row":52,"column":0},"end":{"row":52,"column":4},"action":"insert","lines":["    "]},{"start":{"row":53,"column":0},"end":{"row":53,"column":4},"action":"insert","lines":["    "]},{"start":{"row":54,"column":0},"end":{"row":54,"column":4},"action":"insert","lines":["    "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":4},"action":"insert","lines":["    "]},{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"insert","lines":["    "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"insert","lines":["    "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":4},"action":"insert","lines":["    "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":4},"action":"insert","lines":["    "]},{"start":{"row":60,"column":0},"end":{"row":60,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":10},"action":"remove","lines":["//"],"id":59},{"start":{"row":17,"column":8},"end":{"row":19,"column":25},"action":"insert","lines":["$books = Book::orderBy('created_at', 'asc')->get();","    return view('books', [","        'books' => $books"]}],[{"start":{"row":18,"column":4},"end":{"row":18,"column":8},"action":"insert","lines":["    "],"id":60}],[{"start":{"row":19,"column":25},"end":{"row":20,"column":0},"action":"insert","lines":["",""],"id":61},{"start":{"row":20,"column":0},"end":{"row":20,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":20,"column":8},"end":{"row":20,"column":11},"action":"insert","lines":["]);"],"id":62}],[{"start":{"row":108,"column":8},"end":{"row":108,"column":10},"action":"remove","lines":["//"],"id":63},{"start":{"row":108,"column":8},"end":{"row":109,"column":31},"action":"insert","lines":["$book->delete();       //追加","    return redirect('/');  //追加"]}],[{"start":{"row":109,"column":4},"end":{"row":109,"column":8},"action":"insert","lines":["    "],"id":64}],[{"start":{"row":85,"column":8},"end":{"row":85,"column":10},"action":"remove","lines":["//"],"id":65},{"start":{"row":85,"column":8},"end":{"row":86,"column":52},"action":"insert","lines":["//{books}id 値を取得 => Book $books id 値の1レコード取得","        return view('booksedit', ['book' => $book]);"]}],[{"start":{"row":98,"column":8},"end":{"row":98,"column":10},"action":"remove","lines":["//"],"id":66},{"start":{"row":98,"column":8},"end":{"row":120,"column":29},"action":"insert","lines":["//バリデーション","         $validator = Validator::make($request->all(), [","             'id' => 'required',","             'item_name' => 'required|min:3|max:255',","             'item_number' => 'required|min:1|max:3',","             'item_amount' => 'required|max:6',","             'published' => 'required',","        ]);","        //バリデーション:エラー","         if ($validator->fails()) {","             return redirect('/booksedit/'.$request->id)","                 ->withInput()","                 ->withErrors($validator);","        }","        ","        //データ更新","        $books = Book::find($request->id);","        $books->item_name   = $request->item_name;","        $books->item_number = $request->item_number;","        $books->item_amount = $request->item_amount;","        $books->published   = $request->published;","        $books->save();","        return redirect('/');"]}],[{"start":{"row":17,"column":8},"end":{"row":20,"column":11},"action":"remove","lines":["$books = Book::orderBy('created_at', 'asc')->get();","        return view('books', [","        'books' => $books","        ]);"],"id":67},{"start":{"row":17,"column":8},"end":{"row":20,"column":11},"action":"insert","lines":["$books = Book::orderBy('created_at', 'asc')->paginate(3);","        return view('books', [","            'books' => $books","        ]);"]}],[{"start":{"row":133,"column":5},"end":{"row":134,"column":0},"action":"insert","lines":["",""],"id":68},{"start":{"row":134,"column":0},"end":{"row":134,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":134,"column":4},"end":{"row":137,"column":2},"action":"insert","lines":["public function __construct()"," {","      $this->middleware('auth');"," }"],"id":69}],[{"start":{"row":135,"column":0},"end":{"row":135,"column":4},"action":"insert","lines":["    "],"id":70},{"start":{"row":136,"column":0},"end":{"row":136,"column":4},"action":"insert","lines":["    "]},{"start":{"row":137,"column":0},"end":{"row":137,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":135,"column":4},"end":{"row":135,"column":5},"action":"remove","lines":[" "],"id":71}],[{"start":{"row":137,"column":4},"end":{"row":137,"column":5},"action":"remove","lines":[" "],"id":72}],[{"start":{"row":136,"column":9},"end":{"row":136,"column":10},"action":"remove","lines":[" "],"id":73},{"start":{"row":136,"column":8},"end":{"row":136,"column":9},"action":"remove","lines":[" "]}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":65},"action":"remove","lines":["$books = Book::orderBy('created_at', 'asc')->paginate(3);"],"id":74},{"start":{"row":17,"column":8},"end":{"row":17,"column":100},"action":"insert","lines":["$books = Book::where('user_id',Auth::user()->id)->orderBy('created_at', 'asc')->paginate(3);"]}],[{"start":{"row":45,"column":41},"end":{"row":46,"column":0},"action":"insert","lines":["",""],"id":75},{"start":{"row":46,"column":0},"end":{"row":46,"column":13},"action":"insert","lines":["             "]}],[{"start":{"row":46,"column":13},"end":{"row":46,"column":58},"action":"insert","lines":["$books->user_id  = Auth::user()->id; //追加のコード"],"id":76}],[{"start":{"row":46,"column":12},"end":{"row":46,"column":58},"action":"remove","lines":[" $books->user_id  = Auth::user()->id; //追加のコード"],"id":77}],[{"start":{"row":63,"column":22},"end":{"row":64,"column":0},"action":"insert","lines":["",""],"id":78},{"start":{"row":64,"column":0},"end":{"row":64,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":64,"column":6},"end":{"row":64,"column":52},"action":"insert","lines":[" $books->user_id  = Auth::user()->id; //追加のコード"],"id":79}],[{"start":{"row":64,"column":6},"end":{"row":64,"column":7},"action":"remove","lines":[" "],"id":80}],[{"start":{"row":121,"column":23},"end":{"row":122,"column":0},"action":"insert","lines":["",""],"id":81},{"start":{"row":122,"column":0},"end":{"row":122,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":122,"column":8},"end":{"row":122,"column":77},"action":"insert","lines":["$books = Book::where('user_id',Auth::user()->id)->find($request->id);"],"id":82}],[{"start":{"row":85,"column":4},"end":{"row":89,"column":5},"action":"remove","lines":["public function edit(Book $book)","    {","        //{books}id 値を取得 => Book $books id 値の1レコード取得","        return view('booksedit', ['book' => $book]);","    }"],"id":83},{"start":{"row":85,"column":4},"end":{"row":88,"column":1},"action":"insert","lines":["public function edit($book_id){","    $books = Book::where('user_id',Auth::user()->id)->find($book_id);","    return view('booksedit', ['book' => $books]);","}"]}],[{"start":{"row":86,"column":0},"end":{"row":86,"column":4},"action":"insert","lines":["    "],"id":84},{"start":{"row":87,"column":0},"end":{"row":87,"column":4},"action":"insert","lines":["    "]},{"start":{"row":88,"column":0},"end":{"row":88,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":100},"action":"remove","lines":["$books = Book::where('user_id',Auth::user()->id)->orderBy('created_at', 'asc')->paginate(3);"],"id":85},{"start":{"row":17,"column":8},"end":{"row":17,"column":100},"action":"insert","lines":["$books = Book::where('user_id',Auth::user()->id)->orderBy('created_at', 'asc')->paginate(3);"]}],[{"start":{"row":17,"column":8},"end":{"row":20,"column":11},"action":"remove","lines":["$books = Book::where('user_id',Auth::user()->id)->orderBy('created_at', 'asc')->paginate(3);","        return view('books', [","            'books' => $books","        ]);"],"id":86},{"start":{"row":17,"column":8},"end":{"row":20,"column":11},"action":"insert","lines":["$books = Book::orderBy('created_at', 'asc')->paginate(3);","        return view('books', [","            'books' => $books","        ]);"]}],[{"start":{"row":17,"column":65},"end":{"row":18,"column":0},"action":"insert","lines":["",""],"id":87},{"start":{"row":18,"column":0},"end":{"row":18,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":18,"column":8},"end":{"row":18,"column":100},"action":"insert","lines":["$books = Book::where('user_id',Auth::user()->id)->orderBy('created_at', 'asc')->paginate(3);"],"id":88}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":9},"action":"insert","lines":["?"],"id":89}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":9},"action":"remove","lines":["?"],"id":90}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":11},"action":"insert","lines":["// "],"id":91}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":11},"action":"remove","lines":["// "],"id":92}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":11},"action":"insert","lines":["// "],"id":93}],[{"start":{"row":116,"column":8},"end":{"row":116,"column":9},"action":"insert","lines":["?"],"id":94}],[{"start":{"row":116,"column":8},"end":{"row":116,"column":9},"action":"remove","lines":["?"],"id":95}],[{"start":{"row":116,"column":8},"end":{"row":116,"column":11},"action":"insert","lines":["// "],"id":96}],[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""],"id":97}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":9},"action":"insert","lines":["use Auth;"],"id":98}],[{"start":{"row":2,"column":8},"end":{"row":2,"column":9},"action":"remove","lines":[";"],"id":99},{"start":{"row":2,"column":7},"end":{"row":2,"column":8},"action":"remove","lines":["h"]},{"start":{"row":2,"column":6},"end":{"row":2,"column":7},"action":"remove","lines":["t"]},{"start":{"row":2,"column":5},"end":{"row":2,"column":6},"action":"remove","lines":["u"]},{"start":{"row":2,"column":4},"end":{"row":2,"column":5},"action":"remove","lines":["A"]},{"start":{"row":2,"column":3},"end":{"row":2,"column":4},"action":"remove","lines":[" "]},{"start":{"row":2,"column":2},"end":{"row":2,"column":3},"action":"remove","lines":["e"]},{"start":{"row":2,"column":1},"end":{"row":2,"column":2},"action":"remove","lines":["s"]},{"start":{"row":2,"column":0},"end":{"row":2,"column":1},"action":"remove","lines":["u"]}],[{"start":{"row":7,"column":14},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":100}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":9},"action":"insert","lines":["use Auth;"],"id":101}],[{"start":{"row":44,"column":11},"end":{"row":68,"column":27},"action":"remove","lines":["$validator = Validator::make($request->all(), [","             'item_name' => 'required|min:3|max:255',","             'item_number' => 'required | min:1 | max:3',","             'item_amount' => 'required | max:6',","             'published'   => 'required',","            ","        ]);","    ","        //バリデーション:エラー ","        if ($validator->fails()) {","            return redirect('/')","                ->withInput()","                ->withErrors($validator);","        }","        //以下に登録処理を記述（Eloquentモデル）","    ","      // Eloquentモデル","      $books = new Book;","      $books->item_name   = $request->item_name;","      $books->item_number = $request->item_number;","      $books->item_amount = $request->item_amount;","      $books->published   = $request->published;","      $books->save(); ","      $books->user_id  = Auth::user()->id; //追加のコード","      return redirect('/');"],"id":102},{"start":{"row":44,"column":11},"end":{"row":77,"column":25},"action":"insert","lines":["$validator = Validator::make($request->all(), [","        'item_name' => 'required|string|max:255',","        'item_number' => 'required|integer',","        'item_amount' => 'required|numeric',","        'published' => 'required|date',","    ]);","","    // バリデーション:エラー","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","","    // ユーザー認証を確認し、ユーザーが認証されている場合にユーザーIDを取得","    if (Auth::check()) {","        $user_id = Auth::user()->id;","    } else {","        // ユーザーが認証されていない場合、エラーまたはリダイレクトを行うか、適切な処理を追加してください。","    }","","    // Eloquentモデル","    $book = new Book;","    $book->item_name = $request->item_name;","    $book->item_number = $request->item_number;","    $book->item_amount = $request->item_amount;","    $book->published = $request->published;","","    // ユーザーIDを設定","    $book->user_id = $user_id;","","    $book->save();","","    return redirect('/');"]}]]},"timestamp":1695914839355}